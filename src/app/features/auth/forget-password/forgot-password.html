<div class="auth-container">
  <div class="login-card">

    <!-- Panneau gauche -->
    <div class="left-side">
      <div class="logo-section">
        <img src="assets/images/logo.jpg" alt="Tawsila logo" class="logo">
        <h1>Tawsila</h1>
        <p>Precision Delivery Platform</p>
      </div>

      <!-- Indicateur 4 √©tapes -->
      <div class="steps-indicator">
        <div class="step"
          [class.active]="step() === 'email'"
          [class.done]="step() === 'code' || step() === 'password' || step() === 'success'">
          <div class="step-circle">{{ step() === 'email' ? '1' : '‚úì' }}</div>
          <span>Email</span>
        </div>
        <div class="step-line"></div>
        <div class="step"
          [class.active]="step() === 'code'"
          [class.done]="step() === 'password' || step() === 'success'">
          <div class="step-circle">{{ (step() === 'password' || step() === 'success') ? '‚úì' : '2' }}</div>
          <span>Code</span>
        </div>
        <div class="step-line"></div>
        <div class="step"
          [class.active]="step() === 'password'"
          [class.done]="step() === 'success'">
          <div class="step-circle">{{ step() === 'success' ? '‚úì' : '3' }}</div>
          <span>Mot de passe</span>
        </div>
        <div class="step-line"></div>
        <div class="step" [class.active]="step() === 'success'">
          <div class="step-circle">4</div>
          <span>Termin√©</span>
        </div>
      </div>
    </div>

    <!-- Panneau droit -->
    <div class="right-side">

      <!-- ‚îÄ‚îÄ √âTAPE 1 : Email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <ng-container *ngIf="step() === 'email'">
       
        <h2 class="form-title">Mot de passe oubli√© ?</h2>
        <p class="form-subtitle">
          Entrez votre adresse email pour recevoir un code de v√©rification.
        </p>

        <div class="alert-error" *ngIf="error()">‚ö†Ô∏è {{ error() }}</div>

        <form [formGroup]="emailForm" (ngSubmit)="sendCode()">
          <div class="input-group">
            <label>Adresse email</label>
            <input type="email" formControlName="email" placeholder="votre@email.com"
              [class.input-error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            <span class="field-error"
              *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
              Veuillez entrer un email valide
            </span>
          </div>
          <button type="submit" [disabled]="loading()">
            <span *ngIf="!loading()">üìß Envoyer le code</span>
            <span *ngIf="loading()">‚è≥ Envoi en cours...</span>
          </button>
        </form>

        <div class="footer-link">
          <span>Vous vous souvenez ?</span>
          <a (click)="goToLogin()">Retour connexion</a>
        </div>
      </ng-container>

      <!-- ‚îÄ‚îÄ √âTAPE 2 : Code ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <ng-container *ngIf="step() === 'code'">
       
        <h2 class="form-title">Entrez le code</h2>
        <p class="form-subtitle">
          Un code √† 6 chiffres a √©t√© envoy√© √† <strong>{{ userEmail() }}</strong>
        </p>

        <div class="alert-error" *ngIf="error()">‚ö†Ô∏è {{ error() }}</div>

        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">
          <div class="input-group">
            <label>Code de v√©rification</label>
            <input
              type="text"
              formControlName="code"
              placeholder="_ _ _ _ _ _"
              maxlength="6"
              class="code-input"
              [class.input-error]="codeForm.get('code')?.invalid && codeForm.get('code')?.touched">
            <span class="field-error"
              *ngIf="codeForm.get('code')?.invalid && codeForm.get('code')?.touched">
              Code √† 6 chiffres requis
            </span>
          </div>
          <button type="submit" [disabled]="loading()">
            <span *ngIf="!loading()">‚úÖ V√©rifier le code</span>
            <span *ngIf="loading()">‚è≥ V√©rification...</span>
          </button>
        </form>

        <div class="footer-link">
          <span>Pas re√ßu le code ?</span>
          <a (click)="resendCode()">Renvoyer</a>
        </div>
      </ng-container>

      <!-- ‚îÄ‚îÄ √âTAPE 3 : Nouveau mot de passe ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <ng-container *ngIf="step() === 'password'">
        
        <h2 class="form-title">Nouveau mot de passe</h2>
        <p class="form-subtitle">
          Code v√©rifi√© ‚úÖ Choisissez votre nouveau mot de passe.
        </p>

        <div class="alert-error" *ngIf="error()">‚ö†Ô∏è {{ error() }}</div>

        <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
          <div class="input-group">
            <label>Nouveau mot de passe</label>
            <input type="password" formControlName="nouveauMotDePasse"
              placeholder="Minimum 6 caract√®res"
              [class.input-error]="passwordForm.get('nouveauMotDePasse')?.invalid && passwordForm.get('nouveauMotDePasse')?.touched">
            <span class="field-error"
              *ngIf="passwordForm.get('nouveauMotDePasse')?.invalid && passwordForm.get('nouveauMotDePasse')?.touched">
              Minimum 6 caract√®res requis
            </span>
          </div>

          <div class="input-group">
            <label>Confirmer le mot de passe</label>
            <input type="password" formControlName="confirmerMotDePasse"
              placeholder="R√©p√©ter le mot de passe"
              [class.input-error]="passwordForm.get('confirmerMotDePasse')?.invalid && passwordForm.get('confirmerMotDePasse')?.touched">
            <span class="field-error"
              *ngIf="passwordForm.get('confirmerMotDePasse')?.invalid && passwordForm.get('confirmerMotDePasse')?.touched">
              Confirmation requise
            </span>
          </div>

          <button type="submit" [disabled]="loading()">
            <span *ngIf="!loading()">üîê Changer le mot de passe</span>
            <span *ngIf="loading()">‚è≥ Modification...</span>
          </button>
        </form>
      </ng-container>

      <!-- ‚îÄ‚îÄ √âTAPE 4 : Succ√®s ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <ng-container *ngIf="step() === 'success'">
        <div class="success-screen">
          <div class="success-icon">‚úÖ</div>
          <h2 class="form-title">Mot de passe modifi√© !</h2>
          <p class="form-subtitle">
            Votre mot de passe a √©t√© r√©initialis√© avec succ√®s.
            Connectez-vous avec votre nouveau mot de passe.
          </p>
          <button (click)="goToLogin()">Se connecter maintenant</button>
        </div>
      </ng-container>

    </div>
  </div>
</div>